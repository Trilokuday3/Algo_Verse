<!-- New Clean Header - No semicircle issue -->
<style>
    /* Force header background colors to work properly */
    header.m3-top-app-bar-new {
        background-color: white !important;
        border-bottom: 1px solid rgb(229, 231, 235) !important;
        overflow: hidden !important;
    }

    html.dark header.m3-top-app-bar-new {
        background-color: #1C1B1F !important;
        border-bottom: 1px solid rgb(31, 41, 55) !important;
    }

    /* Force text colors in header for light mode */
    header.m3-top-app-bar-new .m3-title-large {
        color: #1a1a1a !important;
    }

    header.m3-top-app-bar-new .nav-link {
        color: #7c3aed !important;
    }

    /* Active/selected link should be white with purple background */
    header.m3-top-app-bar-new .nav-link.active-nav-link {
        color: white !important;
        background-color: rgb(124, 58, 237) !important;
    }

    /* Dark mode text colors */
    html.dark header.m3-top-app-bar-new .m3-title-large {
        color: white !important;
    }

    html.dark header.m3-top-app-bar-new .nav-link {
        color: rgb(209, 213, 219) !important;
    }

    /* Dark mode active link */
    html.dark header.m3-top-app-bar-new .nav-link.active-nav-link {
        color: rgb(78, 73, 142) !important;
        background-color: #D9C6FF !important;
    }

    /* Theme toggle button colors */
    header.m3-top-app-bar-new #theme-toggle-new {
        color: #1a1a1a !important;
    }

    html.dark header.m3-top-app-bar-new #theme-toggle-new {
        color: rgb(209, 213, 219) !important;
    }

    /* Account button gradient - simple and clean */
    header.m3-top-app-bar-new .account-gradient-new {
        background: #7c3aed !important;
    }

    html.dark header.m3-top-app-bar-new .account-gradient-new {
        background: #D9C6FF !important;
    }

    header.m3-top-app-bar-new .account-gradient-new span {
        color: white !important;
    }

    html.dark header.m3-top-app-bar-new .account-gradient-new span {
        color: #3730A3 !important;
    }
</style>

<header class="m3-top-app-bar-new fixed top-0 left-0 w-full z-40 shadow-sm bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800">
    <nav class="container mx-auto px-4 md:px-6 py-3 flex justify-between items-center">
        <!-- Logo - Simple text only, no circular div -->
        <a href="index.html" class="flex items-center space-x-3 hover:opacity-80 transition-opacity">
            <span class="m3-title-large font-semibold text-gray-900 dark:text-gray-100">ðŸ…° Alpha Z</span>
        </a>
        
        <!-- Navigation Links -->
        <div class="hidden md:flex items-center space-x-2">
            <a href="dashboard.html" data-page="dashboard" class="nav-link m3-label-large px-4 py-2 rounded-full transition-all text-gray-900 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">Dashboard</a>
            <a href="strategies.html" data-page="strategies" class="nav-link m3-label-large px-4 py-2 rounded-full transition-all text-gray-900 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">My Strategies</a>
            <a href="terminal.html" data-page="terminal" class="nav-link m3-label-large px-4 py-2 rounded-full transition-all text-gray-900 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">Terminal</a>
            <a href="history.html" data-page="history" class="nav-link m3-label-large px-4 py-2 rounded-full transition-all text-gray-900 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">History</a>
            <a href="profile.html#broker-section" data-page="profile" class="nav-link m3-label-large px-4 py-2 rounded-full transition-all text-gray-900 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">Broker Connection</a>
        </div>

        <!-- Right Side Actions -->
        <div class="flex items-center space-x-4">
            <!-- Theme Toggle -->
            <button id="theme-toggle-new" class="w-10 h-10 rounded-full flex items-center justify-center focus:outline-none hover:bg-gray-100 dark:hover:bg-gray-800 transition-all text-gray-900 dark:text-gray-300" aria-label="Toggle dark mode" type="button">
                <svg id="theme-toggle-light-icon-new" class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                </svg>
                <svg id="theme-toggle-dark-icon-new" class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
                </svg>
            </button>

            <!-- Account Button -->
            <div class="relative">
                <button id="account-button-new" class="w-11 h-11 rounded-full flex items-center justify-center focus:outline-none transition-all hover:scale-105 account-gradient-new shadow-md" aria-label="Account Menu" aria-haspopup="true" aria-expanded="false">
                    <span class="text-xl font-bold" id="account-initial-new">T</span>
                </button>

                <!-- Account Dropdown -->
                <div id="account-dropdown-new" class="absolute right-0 mt-3 w-80 rounded-2xl hidden z-50 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 shadow-lg" role="menu">
                    <div class="p-4">
                        <!-- User Info -->
                        <div class="flex items-center space-x-3 mb-4 pb-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl account-gradient-new">
                                <span id="dropdown-initial-new">T</span>
                            </div>
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900 dark:text-gray-100" id="user-name-new">Loading...</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400" id="user-email-new">Loading...</p>
                            </div>
                        </div>

                        <!-- Menu Items -->
                        <div class="space-y-1">
                            <a href="profile.html" class="flex items-center space-x-3 px-4 py-3 rounded-xl transition-all hover:bg-gray-100 dark:hover:bg-gray-800">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-green-100 dark:bg-green-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-3-3.87"/><path d="M4 21v-2a4 4 0 0 1 3-3.87"/><circle cx="12" cy="7" r="4"/></svg>
                                </div>
                                <span class="text-gray-900 dark:text-gray-100 font-medium">My Account</span>
                            </a>

                            <a href="profile.html#settings" class="flex items-center space-x-3 px-4 py-3 rounded-xl transition-all hover:bg-gray-100 dark:hover:bg-gray-800">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-blue-100 dark:bg-blue-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 8 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 5 15.4a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 5 8.6a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 8 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09A1.65 1.65 0 0 0 16 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09A1.65 1.65 0 0 0 19.4 15z"/></svg>
                                </div>
                                <span class="text-gray-900 dark:text-gray-100 font-medium">Settings</span>
                            </a>

                            <button id="logout-btn-new" class="flex items-center space-x-3 px-4 py-3 rounded-xl transition-all hover:bg-red-100 dark:hover:bg-red-900 w-full text-left">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-red-100 dark:bg-red-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                                </div>
                                <span class="text-red-600 dark:text-red-400 font-medium">Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<script>
// Theme toggle
document.getElementById('theme-toggle-new')?.addEventListener('click', () => {
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
});

// Set initial theme
if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
}

// Account dropdown toggle
const accountBtn = document.getElementById('account-button-new');
const accountDropdown = document.getElementById('account-dropdown-new');

accountBtn?.addEventListener('click', () => {
    accountDropdown.classList.toggle('hidden');
});

// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
    if (!accountBtn?.contains(e.target) && !accountDropdown?.contains(e.target)) {
        accountDropdown?.classList.add('hidden');
    }
});

// Load user info
const token = localStorage.getItem('token');
if (token) {
    const payload = JSON.parse(atob(token.split('.')[1]));
    const userName = payload.username || 'User';
    const userEmail = payload.email || '';
    const initial = userName.charAt(0).toUpperCase();
    
    document.getElementById('account-initial-new').textContent = initial;
    document.getElementById('dropdown-initial-new').textContent = initial;
    document.getElementById('user-name-new').textContent = userName;
    document.getElementById('user-email-new').textContent = userEmail;
}

// Logout
document.getElementById('logout-btn-new')?.addEventListener('click', () => {
    localStorage.removeItem('token');
    window.location.href = '/login.html';
});

// Active nav link
const currentPage = document.body.dataset.page;
document.querySelectorAll('.nav-link').forEach(link => {
    if (link.dataset.page === currentPage) {
        link.classList.add('active-nav-link');
    }
});
</script>
